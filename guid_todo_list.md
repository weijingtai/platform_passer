跨平台键鼠共享应用需求文档 (PRD)
1. 项目概要
目标：设计并实现一款非商用的跨平台（Windows / macOS）键鼠共享应用。

核心功能：键鼠共享、剪贴板同步、文件拖拽传输、延迟实时监控。

愿景：通过 Rust 与 QUIC 协议提供极低延迟、高安全性的免费开源解决方案。

2. 范围 (Scope)
包含：

Windows (10/11) 与 macOS (Intel/Apple Silicon) 客户端。

基于 QUIC 的加密点对点通信。

实时延迟探测与可视化反馈。

系统级操作通知（连接、传输、错误）。

不包含：Linux 支持、移动端（iOS/Android）、内核级驱动开发（初始阶段）、商业化付费模块。

3. 产品需求 (Functional Requirements)
3.1 核心连接与注入
事件捕获与注入：

Windows：使用 SendInput API 进行事件注入。需识别 UAC 界面状态，当无法注入时及时反馈。

macOS：使用 CGEventPost，需引导用户开启“辅助功能”与“输入监听”权限。

文件传输：仅支持拖拽触发。通过 QUIC 流进行文件分块传输，支持校验与断点续传。

3.2 延迟监测与反馈 (新)
实时探测：通过心跳包采样 RTT（往返时延），计算滑动平均值。

UI 反馈：

绿色 (< 20ms)：连接极佳。

黄色 (20-50ms)：轻微延迟，建议检查网络。

红色 (> 50ms)：严重延迟，警告用户可能存在操作卡顿。

3.3 系统通知机制 (新)
状态通知：设备连接成功、连接断开、权限缺失提醒。

传输通知：文件传输进度条、传输完成路径提示、传输失败原因。

安全通知：新设备配对请求弹窗。

4. 关键技术点与 UAC 处理策略
4.1 Windows UAC 场景应对
原理：UAC 弹出时系统切换至“安全桌面”，应用层 SendInput 会被权限隔离（UIPI）拦截。

策略：

主动检测：当主控端发送指令无响应且检测到目标机处于高权限界面时，通过 UI 弹出通知。

用户引导：通知内容为“当前处于系统安全界面，请手动操作被控端鼠标点击‘是’”。

非驱动限制声明：明确当前版本不包含内核驱动，无法越权操作 UAC 窗口。

4.2 技术栈选型
模块	推荐方案	理由
开发语言	Rust	内存安全、高性能、跨平台一致性好。
网络层	QUIC (quinn)	内置 TLS 1.3，抗丢包能力强，低延迟。
UI 框架	Tauri / Slint	资源占用极低，符合非商用轻量化需求。
图标资源	Lucide / Heroicons	开源免费，风格统一。

导出到 Google 表格

5. 非功能性需求 (NFR)
安全性：强制 mTLS 双向认证，确保只有配对设备可控制电脑。

交互体验：鼠标跨屏需支持 DPI 缩放补偿，避免因分辨率不同导致的坐标跳变。

资源占用：静默状态下 CPU 占用率应 <1%。

6. 风险清单
UAC 阻塞体验：用户在频繁安装软件时需手动点击，可能产生挫败感。

macOS 权限失效：系统更新可能导致 Accessibility 权限重置，需具备权限自检功能。